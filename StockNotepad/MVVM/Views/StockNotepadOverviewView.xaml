<mah:MetroContentControl
    x:Class="StockNotepad.MVVM.Views.StockNotepadOverviewView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Conv="clr-namespace:SharedProject.Converters;assembly=SharedProject"
    xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:mah="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006">


    <mah:MetroContentControl.Resources>
        <Conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </mah:MetroContentControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock
            Grid.Row="0"
            Margin="20,10"
            FontSize="28"
            FontWeight="Bold"
            Foreground="White"
            Text="{Binding SelectedCompanyItem.CompanyName}" />

        <Border
            Grid.Row="1"
            Margin="10,0,10,10"
            Background="Transparent"
            BorderBrush="Gray"
            Padding="5"
            BorderThickness="3"
            CornerRadius="5">
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock
                    Grid.Column="2"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Right"
                    Margin="10,5,10,10"
                    FontSize="18"
                    FontWeight="DemiBold"
                    Foreground="White"
                    Text="{Binding SelectedCompanyItem.Summary.UpdatedAt, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" />

                <DockPanel Grid.Column="0">
                    <Button
                        Width="25"
                        Height="25"
                        Margin="5,5,10,5"
                        Command="{Binding ToggleEditSummaryCommand}"
                        DockPanel.Dock="Right"
                        Style="{StaticResource MahApps.Styles.Button.Circle}"
                        Visibility="{Binding IsEditingSummary, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=true}">
                        <iconPacks:Material
                            Width="12"
                            Height="12"
                            Kind="Pencil" />
                    </Button>

                    <Button
                        Width="25"
                        Height="25"
                        Margin="5,5,0,5"
                        Command="{Binding SaveSummaryCommand}"
                        Visibility="{Binding IsEditingSummary, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=false}">
                        <iconPacks:Material
                            Width="12"
                            Height="12"
                            Kind="Check" />
                    </Button>

                    <Button
                        Width="25"
                        Height="25"
                        Margin="5"
                        Command="{Binding CancelEditSummaryCommand}"
                        Style="{StaticResource MahApps.Styles.Button.Circle}"
                        Visibility="{Binding IsEditingSummary, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=false}">
                        <iconPacks:Material
                            Width="12"
                            Height="12"
                            Kind="Close" />
                    </Button>
                </DockPanel>

                <TextBox
                    Grid.Column="1"
                    Grid.Row="1"
                    FontSize="14"
                    AcceptsReturn="True"
                    Style="{StaticResource MahApps.Styles.TextBox}"
                    Text="{Binding SelectedCompanyItem.Summary.Content, UpdateSourceTrigger=PropertyChanged}"
                    TextWrapping="Wrap"
                    VerticalScrollBarVisibility="Auto"
                    Visibility="{Binding IsEditingSummary, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=false}" />

                <TextBlock
                    Grid.Row="1"
                    Grid.Column="1"
                    FontSize="14"
                    Foreground="White"
                    Text="{Binding SelectedCompanyItem.Summary.Content}"
                    TextWrapping="Wrap"
                    Visibility="{Binding IsEditingSummary, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=true}" />
            </Grid>
        </Border>

        <Border
            Grid.Row="2"
            Margin="10,0,10,10"
            Padding="5"
            BorderBrush="Gray"
            BorderThickness="3"
            CornerRadius="5">
            <ScrollViewer
                Grid.Row="2"
                Margin="20"
                VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding SelectedCompanyItem.Notes}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border
                                Width="300"
                                Height="250"
                                Margin="10"
                                Padding="10"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                CornerRadius="5">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <StackPanel Orientation="Horizontal">
                                        <TextBox
                                            FontWeight="Bold"
                                            Style="{StaticResource MahApps.Styles.TextBox.Search}"
                                            Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}"
                                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=false}" />

                                        <TextBlock
                                            FontWeight="Bold"
                                            Text="{Binding Title}"
                                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=true}" />

                                        <TextBlock
                                            Margin="10,0,0,0"
                                            VerticalAlignment="Center"
                                            Text="{Binding CreatedAt, StringFormat='{}{0:dd/MM HH:mm}'}" />
                                    </StackPanel>

                                    <StackPanel
                                        Grid.Row="0"
                                        HorizontalAlignment="Right"
                                        Orientation="Horizontal">
                                        <Button
                                            Width="25"
                                            Height="25"
                                            Command="{Binding DataContext.EditNoteCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource MahApps.Styles.Button.Circle}"
                                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=true}">
                                            <iconPacks:Material
                                                Width="12"
                                                Height="12"
                                                Kind="Pencil" />
                                        </Button>

                                        <Button
                                            Width="25"
                                            Height="25"
                                            Margin="5,0,0,0"
                                            Command="{Binding DataContext.SaveNoteCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=false}">
                                            <iconPacks:Material
                                                Width="12"
                                                Height="12"
                                                Kind="Check" />
                                        </Button>

                                        <Button
                                            Width="25"
                                            Height="25"
                                            Margin="5,0,0,0"
                                            Command="{Binding DataContext.CancelEditNoteCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=false}">
                                            <iconPacks:Material
                                                Width="12"
                                                Height="12"
                                                Kind="Close" />
                                        </Button>

                                        <Button
                                            Width="25"
                                            Height="25"
                                            Margin="5,0,0,0"
                                            Command="{Binding DataContext.DeleteNoteCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource MahApps.Styles.Button.Circle}">
                                            <iconPacks:Material
                                                Width="12"
                                                Height="12"
                                                Kind="Delete" />
                                        </Button>
                                    </StackPanel>

                                    <TextBox
                                        Grid.Row="1"
                                        Margin="0,10,0,0"
                                        AcceptsReturn="True"
                                        Style="{StaticResource MahApps.Styles.TextBox}"
                                        Text="{Binding Content, UpdateSourceTrigger=PropertyChanged}"
                                        TextWrapping="Wrap"
                                        VerticalScrollBarVisibility="Auto"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=false}" />

                                    <TextBlock
                                        Grid.Row="1"
                                        Margin="0,10,0,0"
                                        VerticalAlignment="Top"
                                        Foreground="White"
                                        Text="{Binding Content}"
                                        TextWrapping="Wrap"
                                        Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=true}" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <Button
            Grid.Row="2"
            Width="60"
            Height="60"
            Margin="20"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Command="{Binding AddNewNoteCommand}">
            <iconPacks:Material
                Width="24"
                Height="24"
                Kind="Plus" />
        </Button>
    </Grid>
</mah:MetroContentControl>
